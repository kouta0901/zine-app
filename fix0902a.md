了解！このプロジェクトでビルド／デプロイが走るように、あなたのプロジェクト ID/番号を埋め込んだコマンドを並べます。
（リージョンは例として asia-northeast1。変更したければ置き換えてください）
	•	PROJECT_ID: vital-analogy-470911-t0
	•	PROJECT_NUM: 830716651527

⸻

1) まず “このプロジェクトを使う” と宣言

# 使うプロジェクトとリージョンを既定にする
gcloud config set project vital-analogy-470911-t0
gcloud config set compute/region asia-northeast1

# 確認
gcloud config list
gcloud projects describe vital-analogy-470911-t0 --format='value(projectId,projectNumber)'

以降の gcloud builds submit / gcloud run deploy は このプロジェクトに対して実行されます。
（毎回明示したい場合は、各コマンドに --project vital-analogy-470911-t0 を付けてもOK）

⸻

2) 必要 API を有効化（初回だけ）

gcloud services enable \
  run.googleapis.com \
  artifactregistry.googleapis.com \
  cloudbuild.googleapis.com


⸻

3) Artifact Registry（Dockerリポ）を作成（初回だけ）

REGION=asia-northeast1
REPO=zine-repo

gcloud artifacts repositories create "$REPO" \
  --repository-format=docker \
  --location="$REGION"


⸻

4) （フォルダ構成そのまま）フロントをビルド→push

リポの zine-app/ が Next.js ルート。そこに Dockerfile と .dockerignore を置いた前提です。

PROJECT_ID=$(gcloud config get-value project)
IMAGE="$REGION-docker.pkg.dev/$PROJECT_ID/$REPO/web:latest"

# ビルド & Artifact Registry に push（Cloud Build を使用）
gcloud builds submit zine-app --tag "$IMAGE"


⸻

5) Cloud Run にデプロイ（公開）

gcloud run deploy web \
  --image="$IMAGE" \
  --region="$REGION" \
  --allow-unauthenticated

URL 取得：

gcloud run services describe web --region="$REGION" --format="value(status.url)"

⚠️ コンテナが 0.0.0.0:$PORT を listen していること（package.json の "start": "next start -p $PORT" を確認）。

⸻

6) トラブル時の確認

# 直近ログ（起動失敗時の原因はほぼここに）
gcloud logging read \
  "resource.type=cloud_run_revision AND resource.labels.service_name=web" \
  --limit=50


⸻

7) （任意）GitHub → Cloud Build の自動化
	1.	コンソール → Cloud Build → Triggers → Connect repository で GitHub を接続
	2.	既にリポ直下に置いた cloudbuild.yaml を指定し、branch を ^main$ などに設定
	3.	以降は git push origin main で Build → Push → Deploy が自動実行されます

⸻

8) （任意）Firebase Hosting から Cloud Run へリライト

npm i -g firebase-tools
firebase login

# このプロジェクトを選択（保持）
firebase use --add
# 一覧に出る "vital-analogy-470911-t0" を選択 → 以降は:
firebase use vital-analogy-470911-t0

# repo ルートに firebase.json を作成してリライト設定
# {
#   "hosting": { "rewrites": [
#     { "source": "**", "run": { "serviceId": "web", "region": "asia-northeast1" } }
#   ]}
# }
firebase deploy --only hosting


⸻

1コマンドで流したい人向け（コピペ可）

export PROJECT_ID=vital-analogy-470911-t0
export REGION=asia-northeast1
export REPO=zine-repo
export IMAGE="$REGION-docker.pkg.dev/$PROJECT_ID/$REPO/web:latest"

gcloud config set project "$PROJECT_ID"
gcloud config set compute/region "$REGION"
gcloud services enable run.googleapis.com artifactregistry.googleapis.com cloudbuild.googleapis.com || true
gcloud artifacts repositories create "$REPO" --repository-format=docker --location="$REGION" || true
gcloud builds submit zine-app --tag "$IMAGE"
gcloud run deploy web --image="$IMAGE" --region="$REGION" --allow-unauthenticated
gcloud run services describe web --region="$REGION" --format="value(status.url)"


⸻

この設定で、すべて“vital-analogy-470911-t0”プロジェクトに対してビルド／デプロイが走ります。
次のステップ（API 追加、Vertex AI 連携、Firestore/Storage/Secrets の導入）も、このプロジェクト ID をそのまま使って進めればOKです。